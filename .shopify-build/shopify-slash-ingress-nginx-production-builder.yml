containers:
  production:
    environment: production
    build:
      command: build/shopify/pipa-main.sh
      timeout: 40m
      env:
        BUILD_CI_BASE_IMAGE: "0"
        FREE_GEOIP_FILES: "GeoLite2-Country.mmdb,GeoLite2-City.mmdb,GeoLite2-ASN.mmdb"
        PAID_GEOIP_FILES: "GeoIP2-ISP.mmdb,GeoIP2-Anonymous-IP.mmdb,GeoIP.dat"
        # GeoLite2-City and GeoLite2-ASN are required even if unused to keep the use-geoip2 configmap setting set to true
        # https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#use-geoip2

steps:
- build: production
- wait
- label: ':admission_tickets: Binary Authorization Checks'
  agents:
    queue: pipa-production
  command: pipa vouch
  timeout_in_minutes: 5
